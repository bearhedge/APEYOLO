Dear Jimmy,

 

Per your request, OAuth 2.0 approved in both live & paper. Please see credentials below + sent via web ticket # 117915.

 

Postman initial set-up:

1. Postman Collection   [Postman -> Collections -> drag & drop the Trading API collection.json attached into Postman]

 

2. Pre-request script for POST /gw/api/v1/sso-sessions   [Postman -> Collections -> open the “Create SSO Session” request (under Authentication) -> Scripts -> choose: Pre-request -> Add the IP address of the user which will be making Web API requests]

   Please add the user’s IP address in line 6

 

3. Postman Environment   [Postman -> Environments -> drag & drop the Trading API (paper/ LIVE) environment into Postman -> left-click on the Environment -> Variables -> add below items]

  clientPublicKey = The contents of your Public RSA Key

  clientPrivateKey = The contents of your Private RSA Key

  accountId = Your IBKR DU/U-account number (used in request URLs for specific Web API endpoints)

 

Paper account (DU9807013):

  clientId = BearHedge-Paper

  clientKeyId = main

  credential = The IBKR Paper account's username (i.e. rrnmtg235)

 

Production/Live account (UXXXXX056):

  clientId = Refer to Web Ticket # 117915

  clientKeyId = Refer to Web Ticket # 117915

  credential = Refer to Web Ticket # 117915

 

Python initial set-up:

Getting started in Python & the Authentication.txt (change to .py) script will require you to add your clientId, clientKeyId, credential (IBKR username), path_to_PrivateKey, and ip -> this script will request an OAuth 2.0 access token & subsequent bearer token using those inputs.

 

 

OAuth 2.0 Flow (Trading Web API):
1. Request an OAuth 2.0 Access Token         (scope = sso-sessions.write)                                                                                                     [POST  https://api.ibkr.com/oauth2/api/v1/token]
2. Create SSO Session for Trading Web API (credential = IBKR username)                                                                                                   [POST  https://api.ibkr.com/gw/api/v1/sso-sessions] 
     →  a 200 response means the user now has read-only access to the “non-/iserver” endpoints

3. Validate SSO Session                                                                                                                                                                                           [GET    https://api.ibkr.com/v1/api/sso/validate]                

4.  Initialize a brokerage session                                                                                                                                                                           [POST  https://api.ibkr.com/v1/api/iserver/auth/ssodh/init]
      →  a 200 response means the user may now access the trading & market data “/iserver” endpoints

5. Sleep for 3-5 seconds. Recommended if the user has just initialized a brokerage session                                                                                

6. Ping the brokerage session every 1-2 minutes                                                                                                                                               [POST  https://api.ibkr.com/v1/api/tickle]                                                                                                               

7. Logout - to close the brokerage session & logout                                                                                                                                          [POST  https://api.ibkr.com/v1/api/logout]

 

Common Error messages:

“401 Unauthorized” errors - if you’re able to retrieve an OAuth 2.0 access token & subsequent bearer token properly, however Web API requests then fail due to “401 Unauthorized” please verify that the IP Address set (in the pre-request script / claims section of POST /gw/api/v1/sso-sessions) is correct.

“401 Unauthorized” errors for the /portfolio endpoints – please call the GET /portfolio/subaccounts 1st, prior to accessing the /portfolio endpoints.

“403 Forbidden” errors for POST /gw/api/v1/sso-sessions – usually this means the credential you’re using is not a valid IBKR username. Please ensure you’re specifying the correct paper/live account’s IBKR username.

“There was an error in evaluating the Pre-request Script: Error: Invalid PEM formatted message.” – please ensure the contents of both RSA keys were pasted correcty into both the Current & Initial value fields (in Postman’s “Environment Variables” section).

The Postman desktop application may be preferred (as opposed to the browser-based version)

 

Documentation:

V1 docs - https://www.interactivebrokers.com/campus/ibkr-api-page/cpapi-v1/#endpoints

New docs - https://www.interactivebrokers.com/campus/ibkr-api-page/webapi-ref/#tag/Authorization-Token | https://api.ibkr.com/gw/swagger-ui.html

 

Kind regards,

John C.

IBKR API Integration